{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport { notification } from 'antd';\nimport { Formik, Form, Field } from 'formik';\nimport { LocalStream } from '@100mslive/hmsvideo-web';\nimport { updateInputDevices, SingleSelect, closeMediaStream, attachMediaStream, getRequest, deviceSupport, getUserMedia, getPermissionStatus } from '../utils';\nimport SoundMeter from './Settings/soundmeter';\nimport ArrowLeftIcon from 'mdi-react/ArrowLeftIcon';\nimport { ROLES } from '../constants';\nimport LoginTextField from './LoginTextField';\n\nclass LoginForm extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"componentDidMount\", async () => {\n      console.log(`%c[APP] Role=${this.props.loginInfo.role}`);\n      this.setState({\n        isSupported: deviceSupport().supported\n      });\n      await this.updatePermission();\n      console.log({\n        permissionGranted: this.state.permissionGranted\n      }); //const { form } = this.props;\n\n      console.log('window.location:' + window.location);\n      console.log('url:' + window.location.protocol + window.location.host + '  ' + window.location.pathname + window.location.query); // if (!this.props.settings.codec) {\n      //   this.props.setSettings({\n      //     selectedAudioDevice: '',\n      //     selectedVideoDevice: '',\n      //     // selectedAudioOutputDevice: \"\",\n      //     resolution: 'qvga',\n      //     bandwidth: 256,\n      //     codec: 'vp8',\n      //     isDevMode: true,\n      //   });\n      // }\n\n      if (this.props.loginInfo.role === ROLES.LIVE_RECORD && this.props.loginInfo.roomId !== '') {\n        console.log(`%c[APP] Skipping audio & video permission promt for the live-record bot`, 'color: blue');\n        const handleLogin = this.props.handleLogin;\n        this.props.setLoginInfo({\n          displayName: null,\n          role: ROLES.LIVE_RECORD\n        });\n        handleLogin();\n        return;\n      } // ToDo: Show a confirmation dialog for ROLES.VIEWER\n\n\n      this.setState({\n        permissionText: 'We will need your permission to use your webcam and microphone.'\n      });\n\n      if (getRequest() && getRequest().hasOwnProperty('room') && this.props.loginInfo.displayName !== '' && this.props.loginInfo.roomId !== '' && this.props.loginInfo.env !== '') {\n        if (this.state.permissionGranted) {\n          console.log('Showing preview');\n          this.startPreview(true);\n        } else {\n          this.setState({\n            formStage: 'PERMISSION'\n          });\n        }\n      } else {\n        let formStage = 'ROOM';\n        console.log(`[FormStage: ${formStage}]`);\n\n        if (this.props.loginInfo.roomId != '') {\n          formStage = 'JOIN_ROOM';\n        }\n\n        this.setState({\n          formStage: formStage\n        });\n      }\n    });\n\n    _defineProperty(this, \"componentWillUnmount\", () => {\n      this._cleanup();\n    });\n\n    _defineProperty(this, \"_notification\", (message, description, type = 'info') => {\n      if (type == 'info') {\n        notification.info({\n          message: message,\n          description: description,\n          placement: 'bottomRight'\n        });\n      } else if (type == 'error') {\n        notification.error({\n          message: message,\n          description: description,\n          placement: 'bottomRight'\n        });\n      }\n    });\n\n    _defineProperty(this, \"_stopMediaStream\", async stream => {\n      let tracks = stream.getTracks();\n\n      for (let i = 0, len = tracks.length; i < len; i++) {\n        await tracks[i].stop();\n      }\n    });\n\n    _defineProperty(this, \"_cleanup\", async () => {\n      if (this.stream) {\n        await this._stopMediaStream(this.stream);\n        await this.client.unpublish(this.stream, this.client.rid);\n      }\n\n      if (this.client) await this.client.leave();\n    });\n\n    _defineProperty(this, \"updateDeviceList\", callback => {\n      updateInputDevices().then(data => {\n        if (this.props.settings.selectedAudioDevice === '' && data.audioDevices.length > 0) {\n          this.props.setSettings({\n            selectedAudioDevice: data.audioDevices[0].deviceId\n          });\n        }\n\n        if (this.props.settings.selectedVideoDevice === '' && data.videoDevices.length > 0) {\n          this.props.setSettings({\n            selectedVideoDevice: data.videoDevices[0].deviceId\n          });\n        } // if (\n        //   this.state.settings.selectedAudioOutputDevice === \"\" &&\n        //   data.audioOutputDevices.length > 0\n        // ) {\n        //   console.log(\"setting output device\")\n        //   this.state.settings.selectedAudioOutputDevice =\n        //     data.audioOutputDevices[0].deviceId\n        // }\n\n\n        this.setState({\n          videoDevices: data.videoDevices,\n          audioDevices: data.audioDevices,\n          audioOutputDevices: data.audioOutputDevices\n        });\n\n        if (callback) {\n          callback();\n        }\n      });\n    });\n\n    _defineProperty(this, \"handleCreateSubmit\", async values => {\n      const endpoint = process.env.NEXT_PUBLIC_CREATE_ROOM_ENDPOINT || '/api/room';\n      console.log('endpoint', endpoint);\n      console.log('Create Room values: ', values);\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        body: JSON.stringify({\n          room_name: values.roomName,\n          recording_info: {\n            enabled: values.isRecording\n          },\n          env: values.env\n        })\n      }).catch(err => {\n        console.log('Error', err);\n      });\n      console.log('Response: ', response);\n\n      if (response.status != 200) {\n        const data = await response.json();\n\n        this._notification('Error', data.message, 'error');\n      } else {\n        const roomEntry = await response.json();\n        console.log('response:', roomEntry);\n        values.roomId = roomEntry.id;\n\n        this._notification('Room Created', `Room Id: ${values.roomId} Room Name: ${values.roomName}`);\n\n        this.handleNameSubmit(values);\n      }\n    });\n\n    _defineProperty(this, \"handleJoinSubmit\", values => {\n      // TODO: How to get roomName from roomId\n      this.handleNameSubmit(values);\n    });\n\n    _defineProperty(this, \"handleNameSubmit\", values => {\n      console.log(this.state.permissionGranted);\n      this.props.setLoginInfo({\n        roomId: values.roomId\n      });\n\n      if (values.roomName) {\n        this.props.setLoginInfo({\n          roomName: values.roomName\n        });\n      }\n\n      if (values.role) {\n        this.props.setLoginInfo({\n          role: values.role\n        });\n      }\n\n      if (values.env) {\n        this.props.setLoginInfo({\n          env: values.env\n        });\n      }\n\n      if (values.displayName) {\n        this.props.setLoginInfo({\n          displayName: values.displayName\n        });\n      }\n\n      if (this.props.loginInfo.role === ROLES.VIEWER) {\n        this.props.handleLogin();\n      } else if (this.state.permissionGranted) {\n        console.log('Showing preview');\n        this.startPreview(true);\n      } else {\n        this.setState({\n          formValues: values,\n          formStage: 'PERMISSION'\n        });\n      }\n    });\n\n    _defineProperty(this, \"handleSubmit\", values => {\n      const handleLogin = this.props.handleLogin;\n      console.log('Values in handleSubmit: ', values);\n      console.log('this.props.loginInfo.roomId in handleSubmit: ', this.props.loginInfo.roomId);\n      if (values.role) this.props.setLoginInfo({\n        role: values.role\n      });\n      if (this.state.formValues) this.props.setLoginInfo({\n        displayName: this.state.formValues.displayName || localStorage.getItem('loginInfo.displayName') || '',\n        roomName: this.state.formValues.roomName,\n        env: this.state.formValues.env\n      });\n      handleLogin();\n    });\n\n    _defineProperty(this, \"updatePermission\", async () => {\n      await getPermissionStatus().then(permission => {\n        if (permission) {\n          this.setState({\n            permissionGranted: true\n          });\n        } else {\n          this.setState({\n            permissionGranted: false\n          });\n        }\n      }).catch(error => {\n        console.log({\n          permissionError: error\n        });\n        this.setState({\n          permissionGranted: false\n        });\n      });\n    });\n\n    _defineProperty(this, \"soundMeterProcess\", () => {\n      var val = window.soundMeter.instant.toFixed(2) * 700 + 1;\n      this.setState({\n        audioLevel: val\n      }); //      if (this.state.visible)\n\n      setTimeout(this.soundMeterProcess, 100);\n    });\n\n    _defineProperty(this, \"startPreview\", (permissionTestMode = false) => {\n      closeMediaStream(window.stream);\n      let audioSource = this.props.settings.selectedAudioDevice;\n      let videoSource = this.props.settings.selectedVideoDevice;\n      let videoElement, soundMeterProcess;\n\n      if (!permissionTestMode) {\n        videoElement = document.getElementById('previewVideo'); // this.soundMeter = window.soundMeter = new SoundMeter(window.audioContext);\n        // soundMeterProcess = this.soundMeterProcess;\n      }\n\n      let constraints = {\n        audio: !this.props.roomState.localAudioEnabled ? true : {\n          deviceId: audioSource ? {\n            exact: audioSource\n          } : undefined\n        },\n        video: !this.props.roomState.localVideoEnabled ? true : {\n          deviceId: videoSource ? {\n            exact: videoSource\n          } : undefined\n        }\n      };\n      getUserMedia(constraints).then(stream => {\n        if (!permissionTestMode) {\n          window.stream = stream; // make stream available to console\n          //videoElement.srcObject = stream;\n\n          attachMediaStream(videoElement, stream); //TODO this throws an error when audio only is chosen. Handle it\n          // if (this.props.roomState.localAudioEnabled) {\n          //   soundMeter.connectToSource(stream);\n          //   setTimeout(soundMeterProcess, 100);\n          // }\n        }\n\n        return navigator.mediaDevices.enumerateDevices(); // Refresh button list in case labels have become available\n      }).then(devices => {\n        //TODO combine with updateInputDevices\n        let videoDevices = [];\n        let audioDevices = [];\n        let audioOutputDevices = [];\n\n        for (let device of devices) {\n          if (device.kind === 'videoinput') {\n            videoDevices.push(device);\n          } else if (device.kind === 'audioinput') {\n            audioDevices.push(device);\n          } else if (device.kind === 'audiooutput') {\n            audioOutputDevices.push(device);\n          }\n        }\n\n        let data = {\n          videoDevices,\n          audioDevices,\n          audioOutputDevices\n        };\n\n        if (this.props.settings.selectedAudioDevice === '' && data.audioDevices.length > 0) {\n          this.props.setSettings({\n            selectedAudioDevice: data.audioDevices[0].deviceId\n          });\n        }\n\n        if (this.props.settings.selectedVideoDevice === '' && data.videoDevices.length > 0) {\n          this.props.setSettings({\n            selectedVideoDevice: data.videoDevices[0].deviceId\n          });\n        }\n\n        this.setState({\n          audioDevices: data.audioDevices,\n          videoDevices: data.videoDevices,\n          permissionGranted: true,\n          formStage: 'PREVIEW'\n        });\n      }).catch(error => {\n        //TODO - look for only permission error. Rest of the errors should be handled\n        this.props.setLocalStreamError(error);\n        this.setState({\n          permissionGranted: false,\n          permissionText: \"You won't be able to access the meeting unless you grant camera and mic permissions\"\n        });\n      });\n    });\n\n    _defineProperty(this, \"updateDevice\", (name, value) => {\n      this.props.setSettings({\n        [name]: value\n      }, () => {\n        this.startPreview(false);\n      });\n    });\n\n    this.state = {\n      formStage: 'ROOM',\n      permissionGranted: false,\n      isSupported: deviceSupport().supported\n    };\n    let role = '';\n    let roomId = '';\n    let env = process.env.NEXT_PUBLIC_SFU_ENV || 'prod-in';\n    let displayName = localStorage.getItem('loginInfo.displayName') || props.loginInfo.displayName || '';\n\n    if (getRequest() && getRequest().hasOwnProperty('role')) {\n      role = getRequest().role;\n    }\n\n    if (getRequest() && getRequest().hasOwnProperty('room')) {\n      roomId = getRequest().room;\n    }\n\n    if (getRequest() && getRequest().hasOwnProperty('env')) {\n      env = getRequest().env;\n    }\n\n    this.props.setLoginInfo({\n      role,\n      roomId,\n      env,\n      displayName\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if ((prevState.formStage || this.state.formStage) && prevState.formStage !== this.state.formStage) {\n      if (this.state.formStage === 'PREVIEW') {\n        this.startPreview(false); //console.log(\"Start preview called from state change componentDidUpdate preview check\")\n      }\n    }\n  }\n\n  render() {\n    console.log(this.state.formStage);\n    const showEnv = !Boolean(process.env.NEXT_PUBLIC_SFU_ENV);\n    const showRoleSelect = Boolean(process.env.NEXT_PUBLIC_SFU_ENV);\n    return __jsx(React.Fragment, null, this.state.isSupported && __jsx(\"div\", {\n      className: \"relative z-0\"\n    }, this.state.formStage && this.state.formStage === 'ROOM' && __jsx(React.Fragment, null, __jsx(\"div\", {\n      className: \" flex items-center justify-center w-full px-4 sm:px-6 lg:px-8\",\n      style: {\n        backgroundColor: '#1a1619',\n        minHeight: 'calc(100vh - 64px)'\n      }\n    }, __jsx(\"div\", {\n      className: \"overflow-hidden justify-right items-right shadow rounded-lg max-w-sm w-full px-4 py-5 p-6 bg-gray-100\"\n    }, __jsx(\"h2\", {\n      className: \"mt-6 text-center text-3xl leading-9 font-extrabold text-gray-900 mb-2\"\n    }, \"100ms Conference\"), __jsx(\"div\", {\n      className: \"mt-6 space-y-2\"\n    }, __jsx(\"button\", {\n      className: \"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none transition duration-150 ease-in-out\",\n      onClick: () => {\n        this.setState({\n          formStage: 'CREATE_ROOM'\n        });\n      }\n    }, \"Create Room\"), __jsx(\"button\", {\n      className: \"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-indigo-600 bg-white hover:text-indigo-700 hover:border-indigo-700 focus:outline-none border-indigo-600 focus:shadow-outline-indigo active:bg-indigo-700 transition duration-150 ease-in-out\",\n      onClick: () => {\n        this.setState({\n          formStage: 'JOIN_ROOM'\n        });\n      }\n    }, \"Join Room\"))))), !this.props.loginInfo.roomId && this.state.formStage && this.state.formStage === 'CREATE_ROOM' && __jsx(React.Fragment, null, __jsx(Formik, {\n      initialValues: {\n        roomName: '',\n        displayName: this.props.loginInfo.displayName,\n        env: process.env.NEXT_PUBLIC_SFU_ENV || 'prod-in',\n        role: 'Host',\n        isRecording: false\n      },\n      validate: values => {\n        const errors = {};\n\n        if (!values.displayName) {\n          errors.displayName = 'Required';\n        }\n\n        if (!values.roomName) {\n          errors.roomName = 'Required';\n        }\n\n        const validRoomPattern = /^[a-zA-Z0-9-.:_]*$/g;\n\n        if (!validRoomPattern.test(values.roomName)) {\n          errors.roomName = 'Accepted characters are a-z, A-Z, 0-9, . - : _';\n        }\n\n        if (showEnv && !values.env) {\n          errors.env = 'Required';\n        }\n\n        return errors;\n      },\n      onSubmit: values => {\n        this.setState({\n          formValues: values\n        });\n        this.handleCreateSubmit(values);\n      }\n    }, ({\n      errors,\n      touched,\n      initialValues\n    }) => __jsx(Form, null, __jsx(\"div\", {\n      className: \" flex items-center justify-center w-full px-4 sm:px-6 lg:px-8\",\n      style: {\n        backgroundColor: '#1a1619',\n        minHeight: 'calc(100vh - 64px)'\n      }\n    }, __jsx(\"div\", {\n      className: \"overflow-hidden shadow rounded-lg max-w-sm w-full px-4 p-6 bg-gray-100\"\n    }, __jsx(\"div\", null, __jsx(\"h2\", {\n      className: \"text-center justify-center items-center text-3xl leading-9 font-extrabold text-gray-900 mb-2\"\n    }, initialValues && __jsx(React.Fragment, null, __jsx(ArrowLeftIcon, {\n      className: \"text-gray-700 hover:text-black\",\n      onClick: () => {\n        this.setState({\n          formStage: 'ROOM'\n        });\n        this.props.setLoginInfo({\n          roomId: ''\n        });\n      }\n    }), \"100ms Conference\"))), __jsx(\"div\", {\n      className: \"rounded-m\"\n    }, __jsx(\"div\", null, __jsx(LoginTextField, {\n      label: \"Room Name\",\n      name: \"roomName\",\n      className: \"rounded-t-md\",\n      placeholder: \"Room Name\",\n      errors: errors.roomName,\n      touched: touched.roomName\n    })), __jsx(\"div\", {\n      className: \"-mt-px\"\n    }, initialValues && __jsx(LoginTextField, {\n      label: \"Username\",\n      name: \"displayName\",\n      className: !(initialValues && !initialValues.roomId) && 'rounded-t-md',\n      placeholder: \"Username\",\n      errors: errors.displayName,\n      touched: touched.displayName\n    })), __jsx(\"div\", {\n      className: \"-mt-px\"\n    }, initialValues ? showRoleSelect ? __jsx(LoginTextField, {\n      label: \"Role\",\n      name: \"role\",\n      as: showRoleSelect ? 'select' : null,\n      className: !showEnv && 'rounded-b-md',\n      placeholder: \"Role\",\n      disabled: this.props.loginInfo.role === ROLES.VIEWER,\n      errors: errors.role,\n      touched: touched.rol\n    }, __jsx(\"option\", {\n      value: \"\"\n    }, \"Select Role\"), Object.values(ROLES).map((role, index) => __jsx(\"option\", {\n      key: index,\n      value: role,\n      className: \"capitalize\"\n    }, role))) : __jsx(LoginTextField, {\n      label: \"Role\",\n      name: \"role\",\n      className: !showEnv && 'rounded-b-md',\n      placeholder: \"Role\",\n      disabled: this.props.loginInfo.role === ROLES.VIEWER,\n      errors: errors.role,\n      touched: touched.rol\n    }) : null), showEnv && __jsx(\"div\", {\n      className: \"-mt-px\"\n    }, initialValues && __jsx(LoginTextField, {\n      label: \"Environment\",\n      name: \"env\",\n      className: \"rounded-b-md\",\n      placeholder: \"Environment (qa-in/staging-in/prod-in)\",\n      errors: errors.env,\n      touched: touched.env\n    }))), __jsx(\"div\", {\n      className: \"mt-6\"\n    }, __jsx(\"label\", null, __jsx(Field, {\n      type: \"checkbox\",\n      name: \"isRecording\"\n    }), '  ', \" Record Room?\")), __jsx(\"div\", {\n      className: \"mt-6\"\n    }, __jsx(\"button\", {\n      type: \"submit\",\n      className: \"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition duration-150 ease-in-out\"\n    }, __jsx(\"span\", {\n      className: \"absolute left-0 inset-y-0 flex items-center pl-3\"\n    }), \"Create Room\"))))))), this.state.formStage && this.state.formStage === 'JOIN_ROOM' && __jsx(React.Fragment, null, __jsx(Formik, {\n      initialValues: {\n        roomId: this.props.loginInfo.roomId ? this.props.loginInfo.roomId : '',\n        displayName: this.props.loginInfo.displayName,\n        env: this.props.loginInfo.env ? this.props.loginInfo.env : '',\n        role: this.props.loginInfo.role ? this.props.loginInfo.role : 'Guest'\n      },\n      validate: values => {\n        const errors = {};\n\n        if (!values.displayName) {\n          errors.displayName = 'Required';\n        }\n\n        if (!values.roomId) {\n          errors.roomId = 'Required';\n        }\n\n        if (showEnv && !values.env) {\n          errors.env = 'Required';\n        }\n\n        return errors;\n      },\n      onSubmit: values => {\n        this.setState({\n          formValues: values\n        });\n        this.handleJoinSubmit(values);\n      }\n    }, ({\n      errors,\n      touched,\n      initialValues\n    }) => __jsx(Form, null, __jsx(\"div\", {\n      className: \" flex items-center justify-center w-full px-4 sm:px-6 lg:px-8\",\n      style: {\n        backgroundColor: '#0B0F15',\n        minHeight: 'calc(100vh - 64px)'\n      }\n    }, __jsx(\"div\", {\n      className: \"overflow-hidden shadow rounded-lg max-w-sm w-full px-4 p-6 bg-gray-100\"\n    }, __jsx(\"div\", null, __jsx(\"h2\", {\n      className: \"text-center text-3xl leading-9 font-extrabold text-gray-900 mb-2\"\n    }, initialValues && __jsx(React.Fragment, null, __jsx(ArrowLeftIcon, {\n      className: \"text-gray-700 hover:text-black\",\n      onClick: () => {\n        this.setState({\n          formStage: 'ROOM'\n        });\n        this.props.setLoginInfo({\n          roomId: ''\n        });\n      }\n    }), \"100ms Conference\")), initialValues && initialValues.roomId && __jsx(\"p\", {\n      className: \"my-2 text-center text-sm leading-5 text-gray-600\"\n    }, \"You are about to join room:\", ' ', __jsx(\"span\", {\n      className: \"font-bold\"\n    }, initialValues.roomId))), __jsx(\"div\", {\n      className: \"rounded-md\"\n    }, __jsx(\"div\", null, initialValues && !initialValues.roomId && __jsx(LoginTextField, {\n      label: \"Room ID\",\n      name: \"roomId\",\n      className: \"rounded-t-md\",\n      placeholder: \"Room ID\",\n      errors: errors.roomId,\n      touched: touched.roomId\n    })), __jsx(\"div\", {\n      className: \"-mt-px\"\n    }, initialValues && __jsx(LoginTextField, {\n      label: \"Username\",\n      name: \"displayName\",\n      className: !(initialValues && !initialValues.roomId) && 'rounded-t-md',\n      placeholder: \"Username\",\n      errors: errors.displayName,\n      touched: touched.displayName\n    })), __jsx(\"div\", {\n      className: \"-mt-px\"\n    }, initialValues ? showRoleSelect ? __jsx(LoginTextField, {\n      label: \"Role\",\n      name: \"role\",\n      as: showRoleSelect ? 'select' : null,\n      className: !showEnv && 'rounded-b-md',\n      placeholder: \"Role\",\n      disabled: this.props.loginInfo.role === ROLES.VIEWER,\n      errors: errors.role,\n      touched: touched.rol\n    }, __jsx(\"option\", {\n      value: \"\"\n    }, \"Select Role\"), Object.values(ROLES).map((role, index) => __jsx(\"option\", {\n      key: index,\n      value: role,\n      className: \"capitalize\"\n    }, role))) : __jsx(LoginTextField, {\n      label: \"Role\",\n      name: \"role\",\n      className: !showEnv && 'rounded-b-md',\n      placeholder: \"Role\",\n      disabled: this.props.loginInfo.role === ROLES.VIEWER,\n      errors: errors.role,\n      touched: touched.rol\n    }) : null), showEnv && __jsx(\"div\", {\n      className: \"-mt-px\"\n    }, initialValues && __jsx(LoginTextField, {\n      label: \"Environment\",\n      name: \"env\",\n      className: \"rounded-b-md\",\n      placeholder: \"Environment (qa-in/staging-in/prod-in)\",\n      errors: errors.env,\n      touched: touched.env\n    }))), __jsx(\"div\", {\n      className: \"mt-6\"\n    }, __jsx(\"button\", {\n      type: \"submit\",\n      className: \"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition duration-150 ease-in-out\"\n    }, __jsx(\"span\", {\n      className: \"absolute left-0 inset-y-0 flex items-center pl-3\"\n    }), \"Join Room\"))))))), this.state.formStage && this.state.formStage === 'PERMISSION' && __jsx(React.Fragment, null, __jsx(\"div\", {\n      className: \" flex items-center justify-center w-full px-4 sm:px-6 lg:px-8\",\n      style: {\n        backgroundColor: '#1a1619',\n        minHeight: 'calc(100vh - 64px)'\n      }\n    }, __jsx(\"div\", {\n      className: \"overflow-hidden shadow rounded-lg max-w-sm w-full px-4 py-5 p-6 bg-gray-100 my-3\"\n    }, __jsx(\"div\", {\n      className: \"\"\n    }, __jsx(\"h2\", {\n      className: \"mt-2 text-center text-3xl leading-9 font-extrabold text-gray-900\"\n    }, \"100ms Conference\"), __jsx(\"p\", {\n      className: \"mt-2 text-center text-sm leading-5 text-gray-600 mb-2\"\n    }, this.state.permissionText), __jsx(\"div\", {\n      className: \"mt-6\"\n    }, __jsx(\"button\", {\n      className: \"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition duration-150 ease-in-out\",\n      onClick: () => {\n        this.startPreview(true);\n      }\n    }, __jsx(\"span\", {\n      className: \"absolute left-0 inset-y-0 flex items-center pl-3\"\n    }), \"Prompt permission dialog\")))))), this.state.formStage && this.state.formStage === 'PREVIEW' && __jsx(React.Fragment, null, __jsx(Formik, {\n      initialValues: {\n        selectedAudioDevice: this.props.settings ? this.props.settings.selectedAudioDevice : null,\n        selectedVideoDevice: this.props.settings ? this.props.settings.selectedVideoDevice : null // selectedAudioOutputDevice: this.state.settings\n        //   ? this.state.settings.selectedAudioOutputDevice\n        //   : null,\n\n      },\n      validate: values => {\n        const errors = {}; // if (!values.displayName) {\n        //   errors.displayName = 'Required';\n        // }\n        // if (!values.roomName){\n        //   errors.roomName = 'Required';\n        // }\n\n        return errors;\n      },\n      onSubmit: values => {\n        if (window.stream) {\n          closeMediaStream(window.stream);\n        }\n\n        this.handleSubmit(values);\n      }\n    }, ({\n      values,\n      initialValues\n    }) => __jsx(Form, null, __jsx(\"div\", {\n      className: \" flex items-center justify-center w-full px-4 sm:px-6 lg:px-8\",\n      style: {\n        backgroundColor: '#1a1619',\n        minHeight: 'calc(100vh - 64px)'\n      }\n    }, __jsx(\"div\", {\n      className: \"overflow-hidden shadow rounded-lg max-w-sm w-full px-4 py-5 p-6 bg-gray-100 my-3\"\n    }, __jsx(\"div\", {\n      className: \"\"\n    }, __jsx(\"h2\", {\n      className: \"mt-2 text-center text-3xl leading-9 font-extrabold text-gray-900\"\n    }, __jsx(React.Fragment, null, \"100ms Conference\")), __jsx(\"p\", {\n      className: \"mt-2 text-center text-sm leading-5 text-gray-600 mb-2\"\n    }, \"You are about to join\", ' ', __jsx(\"span\", {\n      className: \"font-semibold\"\n    }, this.state.formValues ? this.state.formValues.roomName : this.props.loginInfo.roomName), ' ', \"as\", ' ', __jsx(\"span\", {\n      className: \"font-semibold\"\n    }, this.state.formValues ? this.state.formValues.displayName : this.props.loginInfo.displayName), __jsx(\"button\", {\n      className: \"rounded-md px-2 py-1 hover:bg-indigo-500 ml-1 border transition duration-150 ease-in-out\",\n      onClick: () => {\n        this.setState({\n          formStage: 'JOIN_ROOM'\n        });\n      }\n    }, \"Change\"))), __jsx(\"div\", {\n      className: \"mb-3\"\n    }, __jsx(\"div\", {\n      className: \"relative h-48 bg-black rounded-md mb-1\"\n    }, __jsx(\"video\", {\n      id: \"previewVideo\",\n      autoPlay: true,\n      playsInline: true,\n      muted: true,\n      className: `rounded-md h-full w-full ${!this.props.roomState.localVideoEnabled && 'hidden'}`\n    }), __jsx(\"div\", {\n      className: \"absolute bottom-0 w-full flex justify-center pb-1\"\n    }, __jsx(\"button\", {\n      onClick: e => {\n        e.preventDefault();\n        const initialValue = this.props.roomState.localVideoEnabled;\n        this.props.setRoomState({\n          localVideoEnabled: !initialValue\n        });\n      },\n      className: `py-1 px-2 border border-transparent text-sm leading-5 font-medium rounded-md text-white hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 active:bg-indigo-700 transition duration-150 ease-in-out ${this.props.roomState.localVideoEnabled ? 'bg-opacity-50 bg-gray-600' : 'bg-indigo-600'}`\n    }, this.props.roomState.localVideoEnabled && __jsx(\"svg\", {\n      className: \"w-6 h-6\",\n      fill: \"none\",\n      stroke: \"currentColor\",\n      viewBox: \"0 0 24 24\",\n      xmlns: \"http://www.w3.org/2000/svg\"\n    }, __jsx(\"path\", {\n      strokeLinecap: \"round\",\n      strokeLinejoin: \"round\",\n      strokeWidth: 2,\n      d: \"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\"\n    })), !this.props.roomState.localVideoEnabled && __jsx(\"svg\", {\n      className: \"w-6 h-6\",\n      viewBox: \"0 0 24 24\",\n      fill: \"none\",\n      xmlns: \"http://www.w3.org/2000/svg\"\n    }, __jsx(\"path\", {\n      d: \"M15 10L19.553 7.724C19.7054 7.64784 19.8748 7.61188 20.045 7.61955C20.2152 7.62721 20.3806 7.67825 20.5256 7.76781C20.6706 7.85736 20.7902 7.98248 20.8733 8.13127C20.9563 8.28007 20.9999 8.44761 21 8.618V15.382C20.9999 15.5524 20.9563 15.7199 20.8733 15.8687C20.7902 16.0175 20.6706 16.1426 20.5256 16.2322C20.3806 16.3218 20.2152 16.3728 20.045 16.3805C19.8748 16.3881 19.7054 16.3522 19.553 16.276L15 14V10ZM5 18H13C13.5304 18 14.0391 17.7893 14.4142 17.4142C14.7893 17.0391 15 16.5304 15 16V8C15 7.46957 14.7893 6.96086 14.4142 6.58579C14.0391 6.21071 13.5304 6 13 6H5C4.46957 6 3.96086 6.21071 3.58579 6.58579C3.21071 6.96086 3 7.46957 3 8V16C3 16.5304 3.21071 17.0391 3.58579 17.4142C3.96086 17.7893 4.46957 18 5 18Z\",\n      stroke: \"currentColor\",\n      strokeWidth: \"2\",\n      strokeLinecap: \"round\",\n      strokeLinejoin: \"round\"\n    }), __jsx(\"line\", {\n      x1: \"2.00177\",\n      y1: \"19.7113\",\n      x2: \"16.1289\",\n      y2: \"4.10676\",\n      stroke: \"currentColor\",\n      strokeWidth: \"2\",\n      strokeLinecap: \"round\",\n      strokeLinejoin: \"round\"\n    }))), __jsx(\"button\", {\n      onClick: e => {\n        e.preventDefault();\n        const initialValue = this.props.roomState.localAudioEnabled;\n        this.props.setRoomState({\n          localAudioEnabled: !initialValue\n        });\n      },\n      className: `ml-1 py-1 px-2 border border-transparent text-sm leading-5 font-medium rounded-md text-white hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition duration-150 ease-in-out ${this.props.roomState.localAudioEnabled ? 'bg-opacity-50 bg-gray-600' : 'bg-indigo-600'}`\n    }, this.props.roomState.localAudioEnabled && __jsx(\"svg\", {\n      className: \"w-6 h-6\",\n      fill: \"none\",\n      stroke: \"currentColor\",\n      viewBox: \"0 0 24 24\",\n      xmlns: \"http://www.w3.org/2000/svg\"\n    }, __jsx(\"path\", {\n      strokeLinecap: \"round\",\n      strokeLinejoin: \"round\",\n      strokeWidth: \"2\",\n      d: \"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"\n    })), !this.props.roomState.localAudioEnabled && __jsx(\"svg\", {\n      className: \"h-6 w-6\",\n      viewBox: \"0 0 24 24\",\n      fill: \"none\",\n      xmlns: \"http://www.w3.org/2000/svg\"\n    }, __jsx(\"path\", {\n      d: \"M19 11C19 12.8565 18.2625 14.637 16.9497 15.9497C15.637 17.2625 13.8565 18 12 18M12 18C10.1435 18 8.36301 17.2625 7.05025 15.9497C5.7375 14.637 5 12.8565 5 11M12 18V22M12 22H8M12 22H16M12 14C11.2044 14 10.4413 13.6839 9.87868 13.1213C9.31607 12.5587 9 11.7956 9 11V5C9 4.20435 9.31607 3.44129 9.87868 2.87868C10.4413 2.31607 11.2044 2 12 2C12.7956 2 13.5587 2.31607 14.1213 2.87868C14.6839 3.44129 15 4.20435 15 5V11C15 11.7956 14.6839 12.5587 14.1213 13.1213C13.5587 13.6839 12.7956 14 12 14Z\",\n      stroke: \"currentColor\",\n      strokeWidth: \"2\",\n      strokeLinecap: \"round\",\n      strokeLinejoin: \"round\"\n    }), __jsx(\"line\", {\n      x1: \"4.43121\",\n      y1: \"18.0549\",\n      x2: \"18.5583\",\n      y2: \"2.45033\",\n      stroke: \"currentColor\",\n      strokeWidth: \"2\",\n      strokeLinecap: \"round\",\n      strokeLinejoin: \"round\"\n    }))))), this.props.roomState.localAudioEnabled && __jsx(\"div\", {\n      className: \"px-1\"\n    }, __jsx(\"div\", {\n      style: {\n        width: !this.props.roomState.localAudioEnabled ? '1px' : this.state.audioLevel + 'px',\n        height: '4px',\n        backgroundColor: '#8dc63f'\n      }\n    }))), __jsx(\"div\", {\n      className: \"rounded-md shadow-sm\"\n    }, __jsx(\"div\", null, initialValues && __jsx(Field, {\n      label: \"Audio Input\",\n      name: \"selectedAudioDevice\",\n      className: \"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:shadow-outline-blue focus:border-blue-300 focus:z-10 sm:text-sm sm:leading-5\",\n      placeholder: \"Audio Input\",\n      component: SingleSelect,\n      options: this.state.audioDevices,\n      updateDevice: this.updateDevice\n    })), __jsx(\"div\", {\n      className: \"-mt-px\"\n    }, initialValues && __jsx(Field, {\n      label: \"Video Input\",\n      name: \"selectedVideoDevice\",\n      className: `appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:shadow-outline-blue focus:border-blue-300 focus:z-10 sm:text-sm sm:leading-5`,\n      placeholder: \"Video Input\",\n      component: SingleSelect,\n      options: this.state.videoDevices,\n      updateDevice: this.updateDevice\n    }))), __jsx(\"div\", {\n      className: \"mt-0\"\n    }, __jsx(\"button\", {\n      type: \"submit\",\n      className: \"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition duration-150 ease-in-out\"\n    }, __jsx(\"span\", {\n      className: \"absolute left-0 inset-y-0 flex items-center pl-3\"\n    }), \"Join\")))))))), !this.state.isSupported && __jsx(React.Fragment, null, __jsx(\"div\", {\n      className: \" flex items-center justify-center w-full px-4 sm:px-6 lg:px-8\",\n      style: {\n        backgroundColor: '#1a1619',\n        minHeight: 'calc(100vh - 64px)'\n      }\n    }, __jsx(\"div\", {\n      className: \"overflow-hidden shadow rounded-lg max-w-sm w-full px-4 py-5 p-6 bg-gray-100 my-3\"\n    }, __jsx(\"div\", {\n      className: \"\"\n    }, __jsx(\"h2\", {\n      className: \"mt-2 text-center text-3xl leading-9 font-extrabold text-gray-900\"\n    }, \"100ms Conference\"), __jsx(\"p\", {\n      className: \"mt-2 text-center text-sm leading-5 text-gray-600 mb-2\"\n    }, deviceSupport().failureCause == 'iOS' ? __jsx(\"span\", null, \"100ms users might face issues on iOS devices. Please open the link on another device for the best experience. If you wish to continue on iOS, click continue.\") : __jsx(\"span\", null, \"We recommend using Google Chrome for the best experience.\")), __jsx(\"div\", {\n      className: \"mt-6\"\n    }, deviceSupport().failureCause == 'browser' && __jsx(\"a\", {\n      className: \"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 hover:text-white focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition duration-150 ease-in-out\",\n      href: \"https://www.google.com/chrome/\",\n      target: \"_blank\"\n    }, \"Download Google Chrome\"), __jsx(\"button\", {\n      className: \"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-indigo-600 bg-white hover:text-indigo-700 hover:border-indigo-700 focus:outline-none border-indigo-600 focus:shadow-outline-indigo active:bg-indigo-700 transition duration-150 ease-in-out mt-3\",\n      onClick: () => this.setState({\n        isSupported: true\n      })\n    }, \"Continue in current browser\")))))));\n  }\n\n}\n\nfunction objToStrMap(obj) {\n  const strMap = new Map();\n\n  for (const k of Object.keys(obj)) {\n    strMap.set(k, obj[k]);\n  }\n\n  return strMap;\n}\n\nconst WrappedLoginForm = LoginForm; //const WrappedLoginForm = Form.create({ name: \"login\" })(LoginForm);\n\nexport default WrappedLoginForm;","map":null,"metadata":{},"sourceType":"module"}