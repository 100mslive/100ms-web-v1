{"ast":null,"code":"import _regeneratorRuntime from \"/Users/Pravin/Study/nikhil/react/sample-app-web/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _classCallCheck from \"/Users/Pravin/Study/nikhil/react/sample-app-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/Pravin/Study/nikhil/react/sample-app-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/Pravin/Study/nikhil/react/sample-app-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/Pravin/Study/nikhil/react/sample-app-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/Pravin/Study/nikhil/react/sample-app-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/Pravin/Study/nikhil/react/sample-app-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/Users/Pravin/Study/nikhil/react/sample-app-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/Pravin/Study/nikhil/react/sample-app-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nvar _jsxFileName = \"/Users/Pravin/Study/nikhil/react/sample-app-web/src/components/App.jsx\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport { Layout, Button, Modal, notification, Spin } from 'antd';\nvar confirm = Modal.confirm;\nvar Header = Layout.Header,\n    Content = Layout.Content,\n    Sider = Layout.Sider;\nimport MediaSettings from './Settings';\nimport ChatFeed from './Chat';\nimport Message from './Chat/message';\nimport { AppContextProvider, AppContext } from '../stores/AppContext';\nimport LoginForm from './LoginForm';\nimport Conference from './Conference';\nimport { HMSClient, HMSPeer, HMSClientConfig } from '@100mslive/hmsvideo-web';\nimport { ENVS, ROLES } from '../constants';\nimport { dependencies } from '../../package.json';\nimport { getRequest } from '../utils';\nvar sdkVersion = dependencies['@100mslive/hmsvideo-web'].substring(1);\nconsole.info(\"Using hmsvideo-web SDK version \".concat(sdkVersion));\n\nfunction getToken(_x) {\n  return _getToken.apply(this, arguments);\n}\n\nfunction _getToken() {\n  _getToken = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(_ref) {\n    var room_id, user_name, _ref$role, role, env, endpoint, _yield$fetch$then$cat, token;\n\n    return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n      while (1) {\n        switch (_context9.prev = _context9.next) {\n          case 0:\n            room_id = _ref.room_id, user_name = _ref.user_name, _ref$role = _ref.role, role = _ref$role === void 0 ? 'guest' : _ref$role, env = _ref.env;\n            endpoint = process.env.NEXT_PUBLIC_TOKEN_ENDPOINT || '/api/token';\n            _context9.next = 4;\n            return fetch(endpoint, {\n              method: 'POST',\n              body: JSON.stringify({\n                room_id: room_id,\n                user_name: user_name,\n                env: env,\n                role: role\n              })\n            }).then(function (response) {\n              return response.json();\n            })[\"catch\"](function (err) {\n              return console.log('Error client token: ', err);\n            });\n\n          case 4:\n            _yield$fetch$then$cat = _context9.sent;\n            token = _yield$fetch$then$cat.token;\n            return _context9.abrupt(\"return\", token);\n\n          case 7:\n          case \"end\":\n            return _context9.stop();\n        }\n      }\n    }, _callee9);\n  }));\n  return _getToken.apply(this, arguments);\n}\n\nvar OldAppUI = /*#__PURE__*/function (_React$Component) {\n  _inherits(OldAppUI, _React$Component);\n\n  var _super = _createSuper(OldAppUI);\n\n  function OldAppUI(props) {\n    var _this;\n\n    _classCallCheck(this, OldAppUI);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"_cleanUp\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var shouldRedirectToHome,\n          _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              shouldRedirectToHome = _args.length > 0 && _args[0] !== undefined ? _args[0] : true;\n\n              if (!shouldRedirectToHome) {\n                _context.next = 15;\n                break;\n              }\n\n              window.history.pushState({}, '100ms', \"\".concat(window.location.protocol, \"//\").concat(window.location.host));\n              _context.t0 = _this.conference;\n\n              if (!_context.t0) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 7;\n              return _this.conference.cleanUp();\n\n            case 7:\n              _context.t1 = _this.props.client;\n\n              if (!_context.t1) {\n                _context.next = 11;\n                break;\n              }\n\n              _context.next = 11;\n              return _this.props.client.disconnect();\n\n            case 11:\n              _this.props.setClient(null);\n\n              _this.props.setRoomState({\n                isConnected: false,\n                login: false\n              });\n\n              _context.next = 16;\n              break;\n\n            case 15:\n              window.location.reload();\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"_notification\", function (message, description) {\n      notification.info({\n        message: message,\n        description: description,\n        placement: 'bottomRight'\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_createClient\", /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref3) {\n        var userName, env, roomId, role, url, authToken, peer, config;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                userName = _ref3.userName, env = _ref3.env, roomId = _ref3.roomId, role = _ref3.role;\n                url = \"wss://\".concat(env, \".100ms.live\");\n                _context2.next = 4;\n                return getToken({\n                  env: env,\n                  room_id: roomId,\n                  user_name: userName,\n                  role: role\n                });\n\n              case 4:\n                authToken = _context2.sent;\n                console.log(\"%cTOKEN IS: \".concat(authToken), 'color: orange');\n                console.log('Websocket URL', url);\n                _context2.prev = 7;\n                peer = new HMSPeer(userName, authToken);\n                config = new HMSClientConfig({\n                  endpoint: url\n                });\n                return _context2.abrupt(\"return\", new HMSClient(peer, config));\n\n              case 13:\n                _context2.prev = 13;\n                _context2.t0 = _context2[\"catch\"](7);\n                console.error('ERROR: ', _context2.t0);\n                alert('Invalid token');\n\n              case 17:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[7, 13]]);\n      }));\n\n      return function (_x2) {\n        return _ref4.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"_handleJoin\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var client;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _this.props.setRoomState({\n                loading: true\n              });\n\n              _this.hideMessage = function () {}; //TODO this should reflect in initialization as well\n\n\n              ![ROLES.LIVE_RECORD, ROLES.VIEWER].includes(_this.role) && _this._onMediaSettingsChanged(_this.props.settings.selectedAudioDevice, _this.props.settings.selectedVideoDevice, _this.props.settings.resolution, _this.props.settings.bandwidth, _this.props.settings.codec, _this.props.settings.frameRate, _this.props.settings.isDevMode);\n              _context5.next = 5;\n              return _this._createClient({\n                userName: _this.props.loginInfo.displayName,\n                env: _this.props.loginInfo.env,\n                roomId: _this.props.loginInfo.roomId,\n                role: _this.props.loginInfo.role\n              });\n\n            case 5:\n              client = _context5.sent;\n              client.connect()[\"catch\"](function (error) {\n                alert(error.message);\n              });\n              window.onunload = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n                return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        _context3.next = 2;\n                        return _this._cleanUp();\n\n                      case 2:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3);\n              }));\n              client.on('peer-join', function (room, peer) {\n                _this._notification('Peer Join', \"peer => \".concat(peer.name, \" joined \").concat(room, \"!\"));\n              });\n              client.on('peer-leave', function (room, peer) {\n                _this._notification('Peer Leave', \"peer => \".concat(peer.name, \" left \").concat(room, \"!\"));\n              });\n              client.on('connect', function () {\n                console.log('on connect called');\n                if (_this.props.roomState.isConnected) return;\n                console.log('connected!');\n\n                _this._handleTransportOpen();\n              });\n              client.on('disconnect', function () {\n                console.log('disconnected!');\n\n                _this.props.setRoomState({\n                  loading: false\n                });\n              });\n              client.on('stream-add', function (room, peer, streamInfo) {\n                console.log('stream-add', JSON.stringify({\n                  room: room,\n                  peer: peer,\n                  streamInfo: streamInfo\n                }, null, 2));\n              });\n              client.on('stream-remove', function (room, peer, streamInfo) {\n                console.log('stream-remove', JSON.stringify({\n                  room: room,\n                  peer: peer,\n                  streamInfo: streamInfo\n                }, null, 2));\n              });\n              client.on('broadcast', function (room, peer, message) {\n                console.log('broadcast: ', room, peer.name, message);\n\n                _this._onMessageReceived(peer.name, message);\n              });\n              client.on('disconnected', /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n                return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                  while (1) {\n                    switch (_context4.prev = _context4.next) {\n                      case 0:\n                        console.log(\"%c[APP] TEARING DOWN\", 'color:#fc0');\n                        location.reload();\n\n                      case 2:\n                      case \"end\":\n                        return _context4.stop();\n                    }\n                  }\n                }, _callee4);\n              })));\n\n              _this.props.setClient(client);\n\n            case 17:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"_handleTransportOpen\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n      var redirectURL;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _this.props.setRoomState({\n                isConnected: true\n              });\n\n              _context6.prev = 1;\n              _context6.next = 4;\n              return _this.props.client.join(_this.props.loginInfo.roomId)[\"catch\"](function (error) {\n                console.log('JOIN ERROR:', error);\n              });\n\n            case 4:\n              redirectURL = \"\".concat(window.location.protocol, \"//\").concat(window.location.host, \"/?room=\").concat(_this.props.loginInfo.roomId, \"&env=\").concat(_this.props.loginInfo.env, \"&role=\").concat(_this.props.loginInfo.role);\n              window.history.pushState({}, '100ms', redirectURL);\n\n              _this.props.setRoomState({\n                login: true,\n                loading: false\n              });\n\n              _this._notification('Connected!', \"Welcome to the \".concat(_this.props.loginInfo.roomName || '100ms', \" room => \").concat(_this.props.loginInfo.roomId)); // Local video & audio are disabled for the 'live-record'\n              // and 'viewer' roles. Their local stream is also not published.\n\n\n              if ([ROLES.LIVE_RECORD, ROLES.VIEWER].includes(_this.props.loginInfo.role)) {\n                _context6.next = 11;\n                break;\n              }\n\n              _context6.next = 11;\n              return _this.conference.handleLocalStream();\n\n            case 11:\n              _context6.next = 16;\n              break;\n\n            case 13:\n              _context6.prev = 13;\n              _context6.t0 = _context6[\"catch\"](1);\n              console.error('HANDLE THIS ERROR: ', _context6.t0);\n\n            case 16:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, null, [[1, 13]]);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"_handleLeave\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n      var this2;\n      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              this2 = _assertThisInitialized(_this);\n              confirm({\n                title: 'Leave Now?',\n                content: 'Do you want to leave the room?',\n                onOk: function onOk() {\n                  return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n                    return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n                      while (1) {\n                        switch (_context7.prev = _context7.next) {\n                          case 0:\n                            _context7.next = 2;\n                            return this2._cleanUp();\n\n                          case 2:\n                            this2.props.setRoomState({\n                              login: false\n                            });\n\n                          case 3:\n                          case \"end\":\n                            return _context7.stop();\n                        }\n                      }\n                    }, _callee7);\n                  }))();\n                },\n                onCancel: function onCancel() {\n                  console.log('Cancel');\n                }\n              });\n\n            case 2:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"_handleAudioTrackEnabled\", function (enabled) {\n      _this.props.setRoomState({\n        localAudioEnabled: enabled\n      });\n\n      _this.conference.muteMediaTrack('audio', enabled);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_handleVideoTrackEnabled\", function (enabled) {\n      _this.props.setRoomState({\n        localVideoEnabled: enabled\n      });\n\n      _this.conference.muteMediaTrack('video', enabled);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_handleScreenSharing\", function (enabled) {\n      _this.props.setRoomState({\n        screenSharingEnabled: enabled\n      });\n\n      _this.conference.handleScreenSharing(enabled);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_onRef\", function (ref) {\n      _this.conference = ref;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_openOrCloseLeftContainer\", function (collapsed) {\n      _this.props.setRoomState({\n        collapsed: collapsed,\n        hasUnreadMessages: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_onMediaSettingsChanged\", function (selectedAudioDevice, selectedVideoDevice, resolution, bandwidth, codec, frameRate, isDevMode) {\n      var reloadPage = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : false;\n\n      _this.props.setSettings({\n        selectedAudioDevice: selectedAudioDevice,\n        selectedVideoDevice: selectedVideoDevice,\n        resolution: resolution,\n        bandwidth: bandwidth,\n        codec: codec,\n        frameRate: frameRate,\n        isDevMode: isDevMode\n      });\n\n      var constraints = {\n        frameRate: frameRate,\n        bitrate: bandwidth,\n        resolution: resolution,\n        advancedMediaConstraints: {\n          audio: {\n            deviceId: selectedAudioDevice\n          },\n          video: {\n            deviceId: selectedVideoDevice\n          }\n        }\n      };\n\n      if (reloadPage) {\n        _this.props.client && _this.props.client.applyConstraints(constraints, _this.props.client.local);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_onMessageReceived\", function (from, message) {\n      console.log('Received message:' + from + ':' + message);\n      var messages = _this.props.roomState.messages;\n      var uid = 1;\n      messages.push(new Message({\n        id: uid,\n        message: message,\n        senderName: from\n      }));\n      var hasUnreadMessages = false;\n\n      if (_this.props.roomState.collapsed) {\n        hasUnreadMessages = true;\n      }\n\n      _this.props.setRoomState({\n        messages: messages,\n        hasUnreadMessages: hasUnreadMessages\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_onSendMessage\", function (data) {\n      console.log('Send message:' + data);\n      var info = {\n        senderName: _this.props.loginInfo.displayName,\n        msg: data\n      };\n\n      _this.props.client.broadcast(info, _this.props.client.rid);\n\n      var messages = _this.props.roomState.messages;\n      var uid = 0;\n      messages.push(new Message({\n        id: uid,\n        message: data,\n        senderName: 'me'\n      }));\n\n      _this.props.setRoomState({\n        messages: messages\n      });\n    });\n\n    props.setClient(null);\n    props.setRoomState({\n      isConnected: false\n    });\n\n    if (!props.settings.codec) {\n      props.setSettings({\n        selectedAudioDevice: '',\n        selectedVideoDevice: '',\n        resolution: 'qvga',\n        bandwidth: 256,\n        codec: 'vp8',\n        frameRate: 20,\n        isDevMode: true\n      });\n    }\n\n    return _this;\n  }\n\n  _createClass(OldAppUI, [{\n    key: \"isValidParams\",\n    value: function isValidParams() {\n      var validRoomPattern = /^[a-zA-Z0-9-.:_]*$/g;\n      var validRoles = Object.values(ROLES);\n      var validEnvs = Object.values(ENVS);\n\n      try {\n        var params = getRequest();\n\n        if (params.role && !validRoles.includes(params.role.toLowerCase())) {\n          return [false, 'Role'];\n        } else if (params.env && !validEnvs.includes(params.env.toLowerCase())) {\n          return [false, 'environment'];\n        } else if (params.room && !validRoomPattern.test(params.room)) {\n          return [false, 'Room ID'];\n        } else {\n          return [true, null];\n        }\n      } catch (error) {\n        if (error instanceof URIError) {\n          return [false, 'URL'];\n        }\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props$roomState = this.props.roomState,\n          login = _this$props$roomState.login,\n          loading = _this$props$roomState.loading,\n          localAudioEnabled = _this$props$roomState.localAudioEnabled,\n          localVideoEnabled = _this$props$roomState.localVideoEnabled,\n          screenSharingEnabled = _this$props$roomState.screenSharingEnabled,\n          collapsed = _this$props$roomState.collapsed,\n          vidFit = _this$props$roomState.vidFit;\n      var isValidParams = this.isValidParams()[0];\n      return __jsx(Layout, {\n        className: \"app-layout\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 7\n        }\n      }, __jsx(Header, {\n        className: \"app-header\",\n        style: {\n          backgroundColor: '#1a1619',\n          zIndex: '10',\n          padding: '0 0',\n          margin: '0 auto',\n          width: '100%'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 9\n        }\n      }, __jsx(\"div\", {\n        className: \"app-header-left\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 383,\n          columnNumber: 11\n        }\n      }, __jsx(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 384,\n          columnNumber: 13\n        }\n      }, __jsx(\"a\", {\n        href: \"https://100ms.live/\",\n        target: \"_blank\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 385,\n          columnNumber: 13\n        }\n      }, __jsx(\"img\", {\n        src: \"/logo-blue-dark.svg\",\n        className: \"h-8\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 386,\n          columnNumber: 15\n        }\n      })))), __jsx(\"div\", {\n        className: \"app-header-right\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 391,\n          columnNumber: 11\n        }\n      }, __jsx(MediaSettings, {\n        onMediaSettingsChanged: this._onMediaSettingsChanged,\n        settings: this.props.settings,\n        isLoggedIn: login,\n        setLocalStreamError: this.props.setLocalStreamError,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 392,\n          columnNumber: 13\n        }\n      }))), __jsx(Content, {\n        className: \"app-center-layout\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 401,\n          columnNumber: 9\n        }\n      }, !isValidParams ? __jsx(\"div\", {\n        className: \"min-h-screen flex items-center justify-center w-full py-8 px-4 sm:px-6 lg:px-8\",\n        style: {\n          backgroundColor: '#1a1619'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 13\n        }\n      }, __jsx(\"div\", {\n        className: \"overflow-hidden shadow rounded-lg max-w-sm w-full px-4 py-5 p-6 bg-gray-100 my-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 407,\n          columnNumber: 15\n        }\n      }, __jsx(\"div\", {\n        className: \"\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 408,\n          columnNumber: 17\n        }\n      }, __jsx(\"h2\", {\n        className: \"mt-2 text-center text-3xl leading-9 font-extrabold text-gray-900\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 409,\n          columnNumber: 19\n        }\n      }, \"100ms Conference\"), __jsx(\"p\", {\n        className: \"mt-2 text-center text-sm leading-5 text-gray-600 mb-2\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 413,\n          columnNumber: 19\n        }\n      }, \"The requested \", this.isValidParams()[1], \" is invalid. Please verify your credentials.\"), __jsx(\"button\", {\n        className: \"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none transition duration-150 ease-in-out\",\n        onClick: function onClick() {\n          _this2._cleanUp();\n\n          location.reload();\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 418,\n          columnNumber: 19\n        }\n      }, \"Back to Home\")))) : login ? __jsx(Layout, {\n        className: \"app-content-layout\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 13\n        }\n      }, __jsx(Sider, {\n        width: 320,\n        collapsedWidth: 0,\n        trigger: null,\n        collapsible: true,\n        collapsed: collapsed,\n        style: {\n          backgroundColor: '#1a1619'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 15\n        }\n      }, __jsx(\"div\", {\n        className: \"left-container\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 440,\n          columnNumber: 17\n        }\n      }, __jsx(ChatFeed, {\n        messages: this.props.roomState.messages,\n        onSendMessage: this._onSendMessage,\n        onClose: function onClose() {\n          return _this2._openOrCloseLeftContainer(!collapsed);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 441,\n          columnNumber: 19\n        }\n      }))), __jsx(Layout, {\n        className: \"app-right-layout\",\n        style: {\n          height: 'calc(100vh - 64px)'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 448,\n          columnNumber: 15\n        }\n      }, __jsx(Content, {\n        style: {\n          flex: 1,\n          position: 'relative'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 452,\n          columnNumber: 17\n        }\n      }, __jsx(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 453,\n          columnNumber: 19\n        }\n      }, __jsx(AppContext.Consumer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 454,\n          columnNumber: 21\n        }\n      }, function (context) {\n        return __jsx(Conference, {\n          roomName: _this2.props.loginInfo.roomName,\n          roomId: _this2.props.loginInfo.roomId,\n          collapsed: _this2.props.roomState.collapsed,\n          client: context.client,\n          settings: context.settings,\n          localAudioEnabled: localAudioEnabled,\n          localVideoEnabled: localVideoEnabled,\n          vidFit: vidFit,\n          loginInfo: _this2.props.loginInfo,\n          ref: function ref(_ref10) {\n            _this2.conference = _ref10;\n          },\n          onScreenToggle: function onScreenToggle() {\n            return _this2._handleScreenSharing(!screenSharingEnabled);\n          },\n          onLeave: _this2._handleLeave,\n          onChatToggle: function onChatToggle() {\n            _this2._openOrCloseLeftContainer(!collapsed);\n          },\n          isChatOpen: !_this2.props.roomState.collapsed,\n          cleanUp: _this2._cleanUp,\n          role: _this2.props.loginInfo.role,\n          hasUnreadMessages: _this2.props.roomState.hasUnreadMessages,\n          setLocalStreamError: _this2.props.setLocalStreamError,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 456,\n            columnNumber: 25\n          }\n        });\n      }))))) : loading ? __jsx(\"div\", {\n        className: \"flex items-center justify-center\",\n        style: {\n          height: 'calc(100vh - 64px)'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 491,\n          columnNumber: 13\n        }\n      }, __jsx(Spin, {\n        size: \"large\",\n        tip: \"Connecting...\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 495,\n          columnNumber: 15\n        }\n      })) : __jsx(\"div\", {\n        className: \"relative w-full\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 498,\n          columnNumber: 13\n        }\n      }, __jsx(AppContext.Consumer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 499,\n          columnNumber: 15\n        }\n      }, function (context) {\n        return __jsx(LoginForm, {\n          settings: context.settings,\n          loginInfo: context.loginInfo,\n          setSettings: context.setSettings,\n          setLoginInfo: context.setLoginInfo,\n          handleLogin: _this2._handleJoin,\n          createClient: _this2._createClient,\n          client: context.client,\n          setClient: context.setClient,\n          roomState: context.roomState,\n          setRoomState: context.setRoomState,\n          setLocalStreamError: _this2.props.setLocalStreamError,\n          __self: _this2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 501,\n            columnNumber: 19\n          }\n        });\n      })), this.props.localStreamError && __jsx(Modal, {\n        visible: !!this.props.localStreamError,\n        title: this.props.localStreamError.title,\n        footer: [__jsx(Button, {\n          key: \"submit\",\n          type: \"primary\",\n          onClick: function onClick() {\n            _this2._cleanUp(false);\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 523,\n            columnNumber: 17\n          }\n        }, \"Try Again\")],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 519,\n          columnNumber: 13\n        }\n      }, __jsx(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 534,\n          columnNumber: 15\n        }\n      }, this.props.localStreamError.message))));\n    }\n  }]);\n\n  return OldAppUI;\n}(React.Component);\n\nvar OldApp = /*#__PURE__*/function (_React$Component2) {\n  _inherits(OldApp, _React$Component2);\n\n  var _super2 = _createSuper(OldApp);\n\n  function OldApp() {\n    _classCallCheck(this, OldApp);\n\n    return _super2.apply(this, arguments);\n  }\n\n  _createClass(OldApp, [{\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      return __jsx(AppContext.Consumer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 546,\n          columnNumber: 7\n        }\n      }, function (context) {\n        return __jsx(OldAppUI, {\n          settings: context.settings,\n          roomState: context.roomState,\n          loginInfo: context.loginInfo,\n          setSettings: context.setSettings,\n          setLoginInfo: context.setLoginInfo,\n          setRoomState: context.setRoomState,\n          setClient: context.setClient,\n          client: context.client,\n          localStreamError: context.localStreamError,\n          setLocalStreamError: context.setLocalStreamError,\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 548,\n            columnNumber: 11\n          }\n        });\n      });\n    }\n  }]);\n\n  return OldApp;\n}(React.Component);\n\nvar App = /*#__PURE__*/function (_React$Component3) {\n  _inherits(App, _React$Component3);\n\n  var _super3 = _createSuper(App);\n\n  function App() {\n    _classCallCheck(this, App);\n\n    return _super3.apply(this, arguments);\n  }\n\n  _createClass(App, [{\n    key: \"render\",\n    value: function render() {\n      return __jsx(AppContextProvider, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 569,\n          columnNumber: 7\n        }\n      }, __jsx(OldApp, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 570,\n          columnNumber: 9\n        }\n      }));\n    }\n  }]);\n\n  return App;\n}(React.Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/Pravin/Study/nikhil/react/sample-app-web/src/components/App.jsx"],"names":["React","Layout","Button","Modal","notification","Spin","confirm","Header","Content","Sider","MediaSettings","ChatFeed","Message","AppContextProvider","AppContext","LoginForm","Conference","HMSClient","HMSPeer","HMSClientConfig","ENVS","ROLES","dependencies","getRequest","sdkVersion","substring","console","info","getToken","room_id","user_name","role","env","endpoint","process","NEXT_PUBLIC_TOKEN_ENDPOINT","fetch","method","body","JSON","stringify","then","response","json","err","log","token","OldAppUI","props","shouldRedirectToHome","window","history","pushState","location","protocol","host","conference","cleanUp","client","disconnect","setClient","setRoomState","isConnected","login","reload","message","description","placement","userName","roomId","url","authToken","peer","config","error","alert","loading","hideMessage","LIVE_RECORD","VIEWER","includes","_onMediaSettingsChanged","settings","selectedAudioDevice","selectedVideoDevice","resolution","bandwidth","codec","frameRate","isDevMode","_createClient","loginInfo","displayName","connect","onunload","_cleanUp","on","room","_notification","name","roomState","_handleTransportOpen","streamInfo","_onMessageReceived","join","redirectURL","roomName","handleLocalStream","this2","title","content","onOk","onCancel","enabled","localAudioEnabled","muteMediaTrack","localVideoEnabled","screenSharingEnabled","handleScreenSharing","ref","collapsed","hasUnreadMessages","reloadPage","setSettings","constraints","bitrate","advancedMediaConstraints","audio","deviceId","video","applyConstraints","local","from","messages","uid","push","id","senderName","data","msg","broadcast","rid","validRoomPattern","validRoles","Object","values","validEnvs","params","toLowerCase","test","URIError","vidFit","isValidParams","backgroundColor","zIndex","padding","margin","width","setLocalStreamError","_onSendMessage","_openOrCloseLeftContainer","height","flex","position","context","_handleScreenSharing","_handleLeave","setLoginInfo","_handleJoin","localStreamError","Component","OldApp","App"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Layout, Button, Modal, notification, Spin } from 'antd';\nconst { confirm } = Modal;\nconst { Header, Content, Sider } = Layout;\nimport MediaSettings from './Settings';\nimport ChatFeed from './Chat';\nimport Message from './Chat/message';\nimport { AppContextProvider, AppContext } from '../stores/AppContext';\n\nimport LoginForm from './LoginForm';\nimport Conference from './Conference';\nimport { HMSClient, HMSPeer, HMSClientConfig } from '@100mslive/hmsvideo-web';\nimport { ENVS, ROLES } from '../constants';\nimport { dependencies } from '../../package.json';\nimport { getRequest } from '../utils';\n\nconst sdkVersion = dependencies['@100mslive/hmsvideo-web'].substring(1);\nconsole.info(`Using hmsvideo-web SDK version ${sdkVersion}`);\n\nasync function getToken({ room_id, user_name, role = 'guest', env }) {\n  const endpoint = process.env.NEXT_PUBLIC_TOKEN_ENDPOINT || '/api/token';\n  const { token } = await fetch(endpoint, {\n    method: 'POST',\n    body: JSON.stringify({ room_id, user_name, env, role }),\n  })\n    .then(response => response.json())\n    .catch(err => console.log('Error client token: ', err));\n  return token;\n}\n\nclass OldAppUI extends React.Component {\n  constructor(props) {\n    super(props);\n    props.setClient(null);\n    props.setRoomState({\n      isConnected: false,\n    });\n    if (!props.settings.codec) {\n      props.setSettings({\n        selectedAudioDevice: '',\n        selectedVideoDevice: '',\n        resolution: 'qvga',\n        bandwidth: 256,\n        codec: 'vp8',\n        frameRate: 20,\n        isDevMode: true,\n      });\n    }\n  }\n\n  _cleanUp = async (shouldRedirectToHome = true) => {\n    if (shouldRedirectToHome) {\n      window.history.pushState(\n        {},\n        '100ms',\n        `${window.location.protocol}//${window.location.host}`\n      );\n\n      this.conference && (await this.conference.cleanUp());\n      this.props.client && (await this.props.client.disconnect());\n      this.props.setClient(null);\n      this.props.setRoomState({\n        isConnected: false,\n        login: false,\n      });\n    } else {\n      window.location.reload();\n    }\n  };\n\n  _notification = (message, description) => {\n    notification.info({\n      message: message,\n      description: description,\n      placement: 'bottomRight',\n    });\n  };\n\n  _createClient = async ({ userName, env, roomId, role }) => {\n    let url = `wss://${env}.100ms.live`;\n    let authToken = await getToken({\n      env,\n      room_id: roomId,\n      user_name: userName,\n      role,\n    });\n\n    console.log(`%cTOKEN IS: ${authToken}`, 'color: orange');\n    console.log('Websocket URL', url);\n\n    try {\n      let peer = new HMSPeer(userName, authToken);\n\n      let config = new HMSClientConfig({\n        endpoint: url,\n      });\n\n      return new HMSClient(peer, config);\n    } catch (err) {\n      console.error('ERROR: ', err);\n      alert('Invalid token');\n    }\n  };\n\n  _handleJoin = async () => {\n    this.props.setRoomState({\n      loading: true,\n    });\n    this.hideMessage = () => {};\n    //TODO this should reflect in initialization as well\n\n    ![ROLES.LIVE_RECORD, ROLES.VIEWER].includes(this.role) &&\n      this._onMediaSettingsChanged(\n        this.props.settings.selectedAudioDevice,\n        this.props.settings.selectedVideoDevice,\n        this.props.settings.resolution,\n        this.props.settings.bandwidth,\n        this.props.settings.codec,\n        this.props.settings.frameRate,\n        this.props.settings.isDevMode\n      );\n\n    let client = await this._createClient({\n      userName: this.props.loginInfo.displayName,\n      env: this.props.loginInfo.env,\n      roomId: this.props.loginInfo.roomId,\n      role: this.props.loginInfo.role,\n    });\n    client.connect().catch(error => {\n      alert(error.message);\n    });\n\n    window.onunload = async () => {\n      await this._cleanUp();\n    };\n\n    client.on('peer-join', (room, peer) => {\n      this._notification('Peer Join', `peer => ${peer.name} joined ${room}!`);\n    });\n\n    client.on('peer-leave', (room, peer) => {\n      this._notification('Peer Leave', `peer => ${peer.name} left ${room}!`);\n    });\n\n    client.on('connect', () => {\n      console.log('on connect called');\n      if (this.props.roomState.isConnected) return;\n      console.log('connected!');\n      this._handleTransportOpen();\n    });\n\n    client.on('disconnect', () => {\n      console.log('disconnected!');\n      this.props.setRoomState({\n        loading: false,\n      });\n    });\n\n    client.on('stream-add', (room, peer, streamInfo) => {\n      console.log(\n        'stream-add',\n        JSON.stringify({ room, peer, streamInfo }, null, 2)\n      );\n    });\n\n    client.on('stream-remove', (room, peer, streamInfo) => {\n      console.log(\n        'stream-remove',\n        JSON.stringify({ room, peer, streamInfo }, null, 2)\n      );\n    });\n\n    client.on('broadcast', (room, peer, message) => {\n      console.log('broadcast: ', room, peer.name, message);\n      this._onMessageReceived(peer.name, message);\n    });\n\n    client.on('disconnected', async () => {\n      console.log(`%c[APP] TEARING DOWN`, 'color:#fc0');\n      location.reload();\n    });\n\n    this.props.setClient(client);\n  };\n\n  _handleTransportOpen = async () => {\n    this.props.setRoomState({\n      isConnected: true,\n    });\n    try {\n      await this.props.client.join(this.props.loginInfo.roomId).catch(error => {\n        console.log('JOIN ERROR:', error);\n      });\n      let redirectURL = `${window.location.protocol}//${window.location.host}/?room=${this.props.loginInfo.roomId}&env=${this.props.loginInfo.env}&role=${this.props.loginInfo.role}`;\n\n      window.history.pushState({}, '100ms', redirectURL);\n\n      this.props.setRoomState({\n        login: true,\n        loading: false,\n      });\n\n      this._notification(\n        'Connected!',\n        `Welcome to the ${this.props.loginInfo.roomName || '100ms'} room => ${\n          this.props.loginInfo.roomId\n        }`\n      );\n\n      // Local video & audio are disabled for the 'live-record'\n      // and 'viewer' roles. Their local stream is also not published.\n      if (\n        ![ROLES.LIVE_RECORD, ROLES.VIEWER].includes(this.props.loginInfo.role)\n      ) {\n        await this.conference.handleLocalStream();\n      }\n    } catch (error) {\n      console.error('HANDLE THIS ERROR: ', error);\n    }\n  };\n\n  _handleLeave = async () => {\n    let this2 = this;\n    confirm({\n      title: 'Leave Now?',\n      content: 'Do you want to leave the room?',\n      async onOk() {\n        await this2._cleanUp();\n        this2.props.setRoomState({ login: false });\n      },\n      onCancel() {\n        console.log('Cancel');\n      },\n    });\n  };\n\n  _handleAudioTrackEnabled = enabled => {\n    this.props.setRoomState({\n      localAudioEnabled: enabled,\n    });\n    this.conference.muteMediaTrack('audio', enabled);\n  };\n\n  _handleVideoTrackEnabled = enabled => {\n    this.props.setRoomState({\n      localVideoEnabled: enabled,\n    });\n    this.conference.muteMediaTrack('video', enabled);\n  };\n\n  _handleScreenSharing = enabled => {\n    this.props.setRoomState({\n      screenSharingEnabled: enabled,\n    });\n    this.conference.handleScreenSharing(enabled);\n  };\n\n  _onRef = ref => {\n    this.conference = ref;\n  };\n\n  _openOrCloseLeftContainer = collapsed => {\n    this.props.setRoomState({\n      collapsed: collapsed,\n      hasUnreadMessages: false,\n    });\n  };\n\n  _onMediaSettingsChanged = (\n    selectedAudioDevice,\n    selectedVideoDevice,\n    resolution,\n    bandwidth,\n    codec,\n    frameRate,\n    isDevMode,\n    reloadPage = false\n  ) => {\n    this.props.setSettings({\n      selectedAudioDevice,\n      selectedVideoDevice,\n      resolution,\n      bandwidth,\n      codec,\n      frameRate,\n      isDevMode,\n    });\n    const constraints = {\n      frameRate: frameRate,\n      bitrate: bandwidth,\n      resolution: resolution,\n      advancedMediaConstraints: {\n        audio: {\n          deviceId: selectedAudioDevice,\n        },\n        video: {\n          deviceId: selectedVideoDevice,\n        },\n      },\n    };\n    if (reloadPage) {\n      this.props.client &&\n        this.props.client.applyConstraints(\n          constraints,\n          this.props.client.local\n        );\n    }\n  };\n\n  _onMessageReceived = (from, message) => {\n    console.log('Received message:' + from + ':' + message);\n    let messages = this.props.roomState.messages;\n    let uid = 1;\n    messages.push(new Message({ id: uid, message: message, senderName: from }));\n    let hasUnreadMessages = false;\n    if (this.props.roomState.collapsed) {\n      hasUnreadMessages = true;\n    }\n    this.props.setRoomState({ messages, hasUnreadMessages });\n  };\n\n  _onSendMessage = data => {\n    console.log('Send message:' + data);\n    var info = {\n      senderName: this.props.loginInfo.displayName,\n      msg: data,\n    };\n    this.props.client.broadcast(info, this.props.client.rid);\n    let messages = this.props.roomState.messages;\n    let uid = 0;\n    messages.push(new Message({ id: uid, message: data, senderName: 'me' }));\n    this.props.setRoomState({ messages });\n  };\n\n  isValidParams() {\n    const validRoomPattern = /^[a-zA-Z0-9-.:_]*$/g;\n    const validRoles = Object.values(ROLES);\n    const validEnvs = Object.values(ENVS);\n    try {\n      const params = getRequest();\n\n      if (params.role && !validRoles.includes(params.role.toLowerCase())) {\n        return [false, 'Role'];\n      } else if (params.env && !validEnvs.includes(params.env.toLowerCase())) {\n        return [false, 'environment'];\n      } else if (params.room && !validRoomPattern.test(params.room)) {\n        return [false, 'Room ID'];\n      } else {\n        return [true, null];\n      }\n    } catch (error) {\n      if (error instanceof URIError) {\n        return [false, 'URL'];\n      }\n    }\n  }\n\n  render() {\n    const {\n      login,\n      loading,\n      localAudioEnabled,\n      localVideoEnabled,\n      screenSharingEnabled,\n      collapsed,\n      vidFit,\n    } = this.props.roomState;\n\n    const isValidParams = this.isValidParams()[0];\n\n    return (\n      <Layout className=\"app-layout\">\n        <Header\n          className=\"app-header\"\n          style={{\n            backgroundColor: '#1a1619',\n            zIndex: '10',\n            padding: '0 0',\n            margin: '0 auto',\n            width: '100%',\n          }}\n        >\n          <div className=\"app-header-left\">\n            <span>\n            <a href=\"https://100ms.live/\" target=\"_blank\">\n              <img src=\"/logo-blue-dark.svg\" className=\"h-8\" />\n            </a>\n\n            </span>\n          </div>\n          <div className=\"app-header-right\">\n            <MediaSettings\n              onMediaSettingsChanged={this._onMediaSettingsChanged}\n              settings={this.props.settings}\n              isLoggedIn={login}\n              setLocalStreamError={this.props.setLocalStreamError}\n            />\n          </div>\n        </Header>\n\n        <Content className=\"app-center-layout\">\n          {!isValidParams ? (\n            <div\n              className=\"min-h-screen flex items-center justify-center w-full py-8 px-4 sm:px-6 lg:px-8\"\n              style={{ backgroundColor: '#1a1619' }}\n            >\n              <div className=\"overflow-hidden shadow rounded-lg max-w-sm w-full px-4 py-5 p-6 bg-gray-100 my-3\">\n                <div className=\"\">\n                  <h2 className=\"mt-2 text-center text-3xl leading-9 font-extrabold text-gray-900\">\n                    100ms Conference\n                  </h2>\n\n                  <p className=\"mt-2 text-center text-sm leading-5 text-gray-600 mb-2\">\n                    The requested {this.isValidParams()[1]} is invalid. Please\n                    verify your credentials.\n                  </p>\n\n                  <button\n                    className=\"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none transition duration-150 ease-in-out\"\n                    onClick={() => {\n                      this._cleanUp();\n                      location.reload();\n                    }}\n                  >\n                    Back to Home\n                  </button>\n                </div>\n              </div>\n            </div>\n          ) : login ? (\n            <Layout className=\"app-content-layout\">\n              <Sider\n                width={320}\n                collapsedWidth={0}\n                trigger={null}\n                collapsible\n                collapsed={collapsed}\n                style={{ backgroundColor: '#1a1619' }}\n              >\n                <div className=\"left-container\">\n                  <ChatFeed\n                    messages={this.props.roomState.messages}\n                    onSendMessage={this._onSendMessage}\n                    onClose={() => this._openOrCloseLeftContainer(!collapsed)}\n                  />\n                </div>\n              </Sider>\n              <Layout\n                className=\"app-right-layout\"\n                style={{ height: 'calc(100vh - 64px)' }}\n              >\n                <Content style={{ flex: 1, position: 'relative' }}>\n                  <div>\n                    <AppContext.Consumer>\n                      {context => (\n                        <Conference\n                          roomName={this.props.loginInfo.roomName}\n                          roomId={this.props.loginInfo.roomId}\n                          collapsed={this.props.roomState.collapsed}\n                          client={context.client}\n                          settings={context.settings}\n                          localAudioEnabled={localAudioEnabled}\n                          localVideoEnabled={localVideoEnabled}\n                          vidFit={vidFit}\n                          loginInfo={this.props.loginInfo}\n                          ref={ref => {\n                            this.conference = ref;\n                          }}\n                          onScreenToggle={() =>\n                            this._handleScreenSharing(!screenSharingEnabled)\n                          }\n                          onLeave={this._handleLeave}\n                          onChatToggle={() => {\n                            this._openOrCloseLeftContainer(!collapsed);\n                          }}\n                          isChatOpen={!this.props.roomState.collapsed}\n                          cleanUp={this._cleanUp}\n                          role={this.props.loginInfo.role}\n                          hasUnreadMessages={\n                            this.props.roomState.hasUnreadMessages\n                          }\n                          setLocalStreamError={this.props.setLocalStreamError}\n                        />\n                      )}\n                    </AppContext.Consumer>\n                  </div>\n                </Content>\n              </Layout>\n            </Layout>\n          ) : loading ? (\n            <div\n              className=\"flex items-center justify-center\"\n              style={{ height: 'calc(100vh - 64px)' }}\n            >\n              <Spin size=\"large\" tip=\"Connecting...\" />\n            </div>\n          ) : (\n            <div className=\"relative w-full\">\n              <AppContext.Consumer>\n                {context => (\n                  <LoginForm\n                    settings={context.settings}\n                    loginInfo={context.loginInfo}\n                    setSettings={context.setSettings}\n                    setLoginInfo={context.setLoginInfo}\n                    handleLogin={this._handleJoin}\n                    createClient={this._createClient}\n                    client={context.client}\n                    setClient={context.setClient}\n                    roomState={context.roomState}\n                    setRoomState={context.setRoomState}\n                    setLocalStreamError={this.props.setLocalStreamError}\n                  />\n                )}\n              </AppContext.Consumer>\n            </div>\n          )}\n          {this.props.localStreamError && (\n            <Modal\n              visible={!!this.props.localStreamError}\n              title={this.props.localStreamError.title}\n              footer={[\n                <Button\n                  key=\"submit\"\n                  type=\"primary\"\n                  onClick={() => {\n                    this._cleanUp(false);\n                  }}\n                >\n                  Try Again\n                </Button>,\n              ]}\n            >\n              <p>{this.props.localStreamError.message}</p>\n            </Modal>\n          )}\n        </Content>\n      </Layout>\n    );\n  }\n}\n\nclass OldApp extends React.Component {\n  render() {\n    return (\n      <AppContext.Consumer>\n        {context => (\n          <OldAppUI\n            settings={context.settings}\n            roomState={context.roomState}\n            loginInfo={context.loginInfo}\n            setSettings={context.setSettings}\n            setLoginInfo={context.setLoginInfo}\n            setRoomState={context.setRoomState}\n            setClient={context.setClient}\n            client={context.client}\n            localStreamError={context.localStreamError}\n            setLocalStreamError={context.setLocalStreamError}\n          />\n        )}\n      </AppContext.Consumer>\n    );\n  }\n}\n\nclass App extends React.Component {\n  render() {\n    return (\n      <AppContextProvider>\n        <OldApp />\n      </AppContextProvider>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}